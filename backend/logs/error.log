{"code":"ERR_HTTP_HEADERS_SENT","level":"error","message":"Ошибка входа: Cannot set headers after they are sent to the client","service":"equestrian-crm","stack":"Error [ERR_HTTP_HEADERS_SENT]: Cannot set headers after they are sent to the client\n    at ServerResponse.setHeader (node:_http_outgoing:652:11)\n    at ServerResponse.header (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/response.js:794:10)\n    at ServerResponse.send (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/response.js:174:12)\n    at ServerResponse.json (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/response.js:278:15)\n    at /Users/admin/dev/HDCBoltAi/backend/src/routes/auth.js:213:27\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-08-20T04:55:20.697Z"}
{"_message":"Payment validation failed","errors":{"dueDate":{"kind":"required","message":"Срок оплаты обязателен","name":"ValidatorError","path":"dueDate","properties":{"message":"Срок оплаты обязателен","path":"dueDate","type":"required"}},"member":{"kind":"required","message":"Участник обязателен","name":"ValidatorError","path":"member","properties":{"message":"Участник обязателен","path":"member","type":"required"}},"paymentMethod":{"kind":"required","message":"Способ оплаты обязателен","name":"ValidatorError","path":"paymentMethod","properties":{"message":"Способ оплаты обязателен","path":"paymentMethod","type":"required"}},"paymentType":{"kind":"required","message":"Тип платежа обязателен","name":"ValidatorError","path":"paymentType","properties":{"message":"Тип платежа обязателен","path":"paymentType","type":"required"}}},"level":"error","message":"Ошибка создания платежа: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен","service":"equestrian-crm","stack":"ValidationError: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен\n    at Document.invalidate (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3358:32)\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3119:17\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/schemaType.js:1410:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-08-20T18:15:47.577Z"}
{"_message":"Payment validation failed","errors":{"dueDate":{"kind":"required","message":"Срок оплаты обязателен","name":"ValidatorError","path":"dueDate","properties":{"message":"Срок оплаты обязателен","path":"dueDate","type":"required"}},"member":{"kind":"required","message":"Участник обязателен","name":"ValidatorError","path":"member","properties":{"message":"Участник обязателен","path":"member","type":"required"}},"paymentMethod":{"kind":"required","message":"Способ оплаты обязателен","name":"ValidatorError","path":"paymentMethod","properties":{"message":"Способ оплаты обязателен","path":"paymentMethod","type":"required"}},"paymentType":{"kind":"required","message":"Тип платежа обязателен","name":"ValidatorError","path":"paymentType","properties":{"message":"Тип платежа обязателен","path":"paymentType","type":"required"}}},"level":"error","message":"Ошибка создания платежа: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен","service":"equestrian-crm","stack":"ValidationError: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен\n    at Document.invalidate (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3358:32)\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3119:17\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/schemaType.js:1410:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-08-21T04:57:44.036Z"}
{"_message":"Payment validation failed","errors":{"dueDate":{"kind":"required","message":"Срок оплаты обязателен","name":"ValidatorError","path":"dueDate","properties":{"message":"Срок оплаты обязателен","path":"dueDate","type":"required"}},"member":{"kind":"required","message":"Участник обязателен","name":"ValidatorError","path":"member","properties":{"message":"Участник обязателен","path":"member","type":"required"}},"paymentMethod":{"kind":"required","message":"Способ оплаты обязателен","name":"ValidatorError","path":"paymentMethod","properties":{"message":"Способ оплаты обязателен","path":"paymentMethod","type":"required"}},"paymentType":{"kind":"required","message":"Тип платежа обязателен","name":"ValidatorError","path":"paymentType","properties":{"message":"Тип платежа обязателен","path":"paymentType","type":"required"}}},"level":"error","message":"Ошибка создания платежа: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен","service":"equestrian-crm","stack":"ValidationError: Payment validation failed: dueDate: Срок оплаты обязателен, paymentMethod: Способ оплаты обязателен, paymentType: Тип платежа обязателен, member: Участник обязателен\n    at Document.invalidate (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3358:32)\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3119:17\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/schemaType.js:1410:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-08-21T05:10:54.946Z"}
{"_message":"Payment validation failed","errors":{"user":{"kind":"required","message":"Path `user` is required.","name":"ValidatorError","path":"user","properties":{"message":"Path `user` is required.","path":"user","type":"required"}}},"level":"error","message":"Ошибка создания платежа: Payment validation failed: user: Path `user` is required.","service":"equestrian-crm","stack":"ValidationError: Payment validation failed: user: Path `user` is required.\n    at Document.invalidate (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3358:32)\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3119:17\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/schemaType.js:1410:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-08-21T05:12:08.925Z"}
{"_message":"Payment validation failed","errors":{"user":{"kind":"required","message":"Path `user` is required.","name":"ValidatorError","path":"user","properties":{"message":"Path `user` is required.","path":"user","type":"required"}}},"level":"error","message":"Ошибка создания платежа: Payment validation failed: user: Path `user` is required.","service":"equestrian-crm","stack":"ValidationError: Payment validation failed: user: Path `user` is required.\n    at Document.invalidate (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3358:32)\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/document.js:3119:17\n    at /Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/schemaType.js:1410:9\n    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)","timestamp":"2025-08-21T05:12:22.683Z"}
{"level":"error","message":"Ошибка аутентификации: invalid signature","name":"JsonWebTokenError","service":"equestrian-crm","stack":"JsonWebTokenError: invalid signature\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:171:19\n    at getSecret (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:101:10)\n    at handleAuth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:16:27)\n    at auth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:43:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-21T05:25:08.078Z"}
{"level":"error","message":"Ошибка аутентификации: invalid signature","name":"JsonWebTokenError","service":"equestrian-crm","stack":"JsonWebTokenError: invalid signature\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:171:19\n    at getSecret (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:101:10)\n    at handleAuth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:16:27)\n    at auth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:43:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-21T06:15:50.428Z"}
{"level":"error","message":"Ошибка аутентификации: invalid signature","name":"JsonWebTokenError","service":"equestrian-crm","stack":"JsonWebTokenError: invalid signature\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:171:19\n    at getSecret (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:101:10)\n    at handleAuth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:16:27)\n    at auth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:43:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-25T05:54:53.297Z"}
{"level":"error","message":"Ошибка подключения к MongoDB:","service":"equestrian-crm","timestamp":"2025-08-25T07:59:36.236Z"}
{"level":"error","message":"Ошибка MongoDB: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.","service":"equestrian-crm","stack":"MongooseError: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.\n    at NativeConnection.createClient (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)\n    at NativeConnection.openUri (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/connection.js:1071:34)\n    at Mongoose.connect (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/mongoose.js:450:15)\n    at /Users/admin/dev/HDCBoltAi/backend/src/config/database.js:16:14\n    at new Promise (<anonymous>)\n    at connectDB (/Users/admin/dev/HDCBoltAi/backend/src/config/database.js:8:10)\n    at Object.<anonymous> (/Users/admin/dev/HDCBoltAi/backend/src/server.js:26:1)\n    at Module._compile (node:internal/modules/cjs/loader:1376:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1435:10)\n    at Module.load (node:internal/modules/cjs/loader:1207:32)","timestamp":"2025-08-25T07:59:36.237Z"}
{"level":"error","message":"Ошибка подключения к MongoDB:","service":"equestrian-crm","timestamp":"2025-08-25T08:00:59.214Z"}
{"level":"error","message":"Ошибка MongoDB: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.","service":"equestrian-crm","stack":"MongooseError: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.\n    at NativeConnection.createClient (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)\n    at NativeConnection.openUri (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/connection.js:1071:34)\n    at Mongoose.connect (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/mongoose.js:450:15)\n    at /Users/admin/dev/HDCBoltAi/backend/src/config/database.js:16:14\n    at new Promise (<anonymous>)\n    at connectDB (/Users/admin/dev/HDCBoltAi/backend/src/config/database.js:8:10)\n    at Object.<anonymous> (/Users/admin/dev/HDCBoltAi/backend/src/server.js:26:1)\n    at Module._compile (node:internal/modules/cjs/loader:1376:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1435:10)\n    at Module.load (node:internal/modules/cjs/loader:1207:32)","timestamp":"2025-08-25T08:00:59.215Z"}
{"level":"error","message":"Ошибка подключения к MongoDB:","service":"equestrian-crm","timestamp":"2025-08-25T08:01:31.172Z"}
{"level":"error","message":"Ошибка MongoDB: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.","service":"equestrian-crm","stack":"MongooseError: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.\n    at NativeConnection.createClient (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)\n    at NativeConnection.openUri (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/connection.js:1071:34)\n    at Mongoose.connect (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/mongoose.js:450:15)\n    at /Users/admin/dev/HDCBoltAi/backend/src/config/database.js:20:14\n    at new Promise (<anonymous>)\n    at connectDB (/Users/admin/dev/HDCBoltAi/backend/src/config/database.js:8:10)\n    at Object.<anonymous> (/Users/admin/dev/HDCBoltAi/backend/src/server.js:26:1)\n    at Module._compile (node:internal/modules/cjs/loader:1376:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1435:10)\n    at Module.load (node:internal/modules/cjs/loader:1207:32)","timestamp":"2025-08-25T08:01:31.173Z"}
{"level":"error","message":"Ошибка подключения к MongoDB:","service":"equestrian-crm","timestamp":"2025-08-25T08:03:11.230Z"}
{"level":"error","message":"Ошибка MongoDB: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.","service":"equestrian-crm","stack":"MongooseError: The `uri` parameter to `openUri()` must be a string, got \"undefined\". Make sure the first parameter to `mongoose.connect()` or `mongoose.createConnection()` is a string.\n    at NativeConnection.createClient (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/drivers/node-mongodb-native/connection.js:237:11)\n    at NativeConnection.openUri (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/connection.js:1071:34)\n    at Mongoose.connect (/Users/admin/dev/HDCBoltAi/node_modules/mongoose/lib/mongoose.js:450:15)\n    at /Users/admin/dev/HDCBoltAi/backend/src/config/database.js:16:14\n    at new Promise (<anonymous>)\n    at connectDB (/Users/admin/dev/HDCBoltAi/backend/src/config/database.js:8:10)\n    at Object.<anonymous> (/Users/admin/dev/HDCBoltAi/backend/src/server.js:26:1)\n    at Module._compile (node:internal/modules/cjs/loader:1376:14)\n    at Module._extensions..js (node:internal/modules/cjs/loader:1435:10)\n    at Module.load (node:internal/modules/cjs/loader:1207:32)","timestamp":"2025-08-25T08:03:11.231Z"}
{"level":"error","message":"Ошибка входа: \"jwtExpire\" is not allowed in \"options\"","service":"equestrian-crm","stack":"Error: \"jwtExpire\" is not allowed in \"options\"\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:51:17\n    at Array.forEach (<anonymous>)\n    at validate (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:47:6)\n    at validateOptions (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:62:10)\n    at module.exports [as sign] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:171:5)\n    at /Users/admin/dev/HDCBoltAi/backend/src/routes/auth.js:222:29\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-08-25T08:17:10.844Z"}
{"level":"error","message":"Ошибка входа: \"jwtExpire\" is not allowed in \"options\"","service":"equestrian-crm","stack":"Error: \"jwtExpire\" is not allowed in \"options\"\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:51:17\n    at Array.forEach (<anonymous>)\n    at validate (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:47:6)\n    at validateOptions (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:62:10)\n    at module.exports [as sign] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:171:5)\n    at /Users/admin/dev/HDCBoltAi/backend/src/routes/auth.js:222:29\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-08-25T08:17:28.641Z"}
{"level":"error","message":"Ошибка входа: \"jwtExpire\" is not allowed in \"options\"","service":"equestrian-crm","stack":"Error: \"jwtExpire\" is not allowed in \"options\"\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:51:17\n    at Array.forEach (<anonymous>)\n    at validate (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:47:6)\n    at validateOptions (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:62:10)\n    at module.exports [as sign] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/sign.js:171:5)\n    at /Users/admin/dev/HDCBoltAi/backend/src/routes/auth.js:224:29\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)","timestamp":"2025-08-25T08:20:51.980Z"}
{"expiredAt":"2025-08-21T02:41:40.000Z","level":"error","message":"Ошибка аутентификации: jwt expired","name":"TokenExpiredError","service":"equestrian-crm","stack":"TokenExpiredError: jwt expired\n    at /Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:190:21\n    at getSecret (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:97:14)\n    at module.exports [as verify] (/Users/admin/dev/HDCBoltAi/node_modules/jsonwebtoken/verify.js:101:10)\n    at handleAuth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:17:27)\n    at auth (/Users/admin/dev/HDCBoltAi/backend/src/middleware/auth.js:44:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/admin/dev/HDCBoltAi/node_modules/express/lib/router/index.js:284:15","timestamp":"2025-08-25T08:56:10.698Z"}
